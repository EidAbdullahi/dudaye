{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}Policies | Health Insurance{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto p-6 bg-white rounded-xl shadow-lg mt-8">

  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">Policies</h1>
    <a href="{% url 'policies:add_policy' %}" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
      âž• Add New Policy
    </a>
  </div>

  <!-- Messages -->
  {% if messages %}
    {% for message in messages %}
      <div class="mb-4 px-4 py-2 rounded {{ message.tags|default:'bg-gray-100 text-gray-800' }}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <!-- Policies Table -->
  <table class="min-w-full border border-gray-200 rounded-lg overflow-hidden text-sm">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-4 py-2 border-b">Policy #</th>
        <th class="px-4 py-2 border-b">Client</th>
        <th class="px-4 py-2 border-b">Type</th>
        <th class="px-4 py-2 border-b">Premium</th>
        <th class="px-4 py-2 border-b">Start Date</th>
        <th class="px-4 py-2 border-b">Expiry Date</th>
        <th class="px-4 py-2 border-b">Days Left</th>
        <th class="px-4 py-2 border-b">Active</th>
        <th class="px-4 py-2 border-b">Coverage</th>
        <th class="px-4 py-2 border-b">Max Claim ($)</th>
        <th class="px-4 py-2 border-b">Waiting Period (days)</th>
        <th class="px-4 py-2 border-b">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for policy in policies %}
      <tr class="hover:bg-gray-50">
        <td class="px-4 py-2 border-b">{{ policy.policy_number }}</td>
        <td class="px-4 py-2 border-b">{{ policy.client.first_name }} {{ policy.client.last_name }}</td>
        <td class="px-4 py-2 border-b">{{ policy.get_policy_type_display }}</td>
        <td class="px-4 py-2 border-b">${{ policy.premium }}</td>
        <td class="px-4 py-2 border-b">{{ policy.start_date }}</td>
        <td class="px-4 py-2 border-b">{{ policy.expiry_date }}</td>
        <td class="px-4 py-2 border-b">
          {% if policy.days_left >= 0 %}
            <span class="text-green-600 font-semibold">{{ policy.days_left }} days</span>
          {% else %}
            <span class="text-red-600 font-semibold">Expired</span>
          {% endif %}
        </td>
        <td class="px-4 py-2 border-b">
          {% if policy.is_active %}
            <span class="text-green-600 font-bold">Yes</span>
          {% else %}
            <span class="text-red-600 font-bold">No</span>
          {% endif %}
        </td>
        <td class="px-4 py-2 border-b">{{ policy.coverage_details|truncatechars:40 }}</td>
        <td class="px-4 py-2 border-b">${{ policy.max_claim_limit }}</td>
        <td class="px-4 py-2 border-b">{{ policy.waiting_period_days }}</td>
        <td class="px-4 py-2 border-b space-x-2">
          <a href="{% url 'policies:policy_detail' policy.id %}" class="text-blue-600 hover:underline">View</a>
          <a href="{% url 'policies:edit_policy' policy.id %}" class="text-yellow-600 hover:underline">Edit</a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="12" class="text-center px-4 py-6 text-gray-500">No policies found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
