{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}{{ dashboard_title }} | Health Insurance{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto p-6 bg-white rounded-2xl shadow-lg mt-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">{{ dashboard_title }}</h1>
    <a href="{% url 'claims:claim_list' %}" 
       class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
      ‚Üê Back to Claims
    </a>
  </div>

  <!-- Claim Information -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-800">
    <div>
      <p class="font-semibold">Claim Number:</p>
      <p>{{ claim.claim_number }}</p>
    </div>

    <div>
      <p class="font-semibold">Client:</p>
      <p>{{ claim.client.first_name }} {{ claim.client.last_name }}</p>
    </div>

    <div>
      <p class="font-semibold">Policy:</p>
      <p>{{ claim.policy.policy_number }}</p>
    </div>

    <div>
      <p class="font-semibold">Hospital:</p>
      <p>{% if claim.hospital %}{{ claim.hospital.name }}{% else %}N/A{% endif %}</p>
    </div>

    <div>
      <p class="font-semibold">Amount:</p>
      <p>${{ claim.amount }}</p>
    </div>

    <div>
      <p class="font-semibold">Status:</p>
      <span class="capitalize 
        {% if claim.status == 'approved' %}text-green-600{% elif claim.status == 'rejected' %}text-red-600{% else %}text-yellow-600{% endif %}">
        {{ claim.status }}
      </span>
    </div>

    <div class="md:col-span-2">
      <p class="font-semibold">Notes / Description:</p>
      <p>{{ claim.notes|default:"N/A" }}</p>
    </div>

    <div>
      <p class="font-semibold">Created By:</p>
      <p>{{ claim.created_by }}</p>
    </div>

    <div>
      <p class="font-semibold">Date Created:</p>
      <p>{{ claim.created_at|date:"M d, Y H:i" }}</p>
    </div>
  </div>

  <!-- Admin / Officer Actions -->
  {% if role == "admin" or role == "claim_officer" %}
  <div class="mt-8 border-t pt-6">
    <h2 class="text-lg font-semibold text-gray-800 mb-3">Actions</h2>
    <div class="flex flex-wrap gap-3">

      <!-- Edit -->
      <a href="{% url 'claims:edit_claim' claim.id %}" 
         class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
        ‚úèÔ∏è Edit
      </a>

      <!-- Approve -->
      {% if claim.status != "approved" %}
      <form method="POST" action="{% url 'claims:approve_claim' claim.id %}">
        {% csrf_token %}
        <button type="submit" 
                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
          ‚úÖ Approve
        </button>
      </form>
      {% endif %}

      <!-- Reject -->
      {% if claim.status != "rejected" %}
      <form method="POST" action="{% url 'claims:reject_claim' claim.id %}">
        {% csrf_token %}
        <button type="submit" 
                class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
          ‚ùå Reject
        </button>
      </form>
      {% endif %}

      <!-- Reimburse (Admin Only) -->
      {% if role == "admin" and claim.status == "approved" %}
      <form method="POST" action="{% url 'claims:reimburse_claim' claim.id %}">
        {% csrf_token %}
        <button type="submit" 
                class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
          üí∞ Mark as Reimbursed
        </button>
      </form>
      {% endif %}
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
